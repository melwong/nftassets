(self.webpackChunkether_and_erc20_tokens_woocommerce_payment_gateway=self.webpackChunkether_and_erc20_tokens_woocommerce_payment_gateway||[]).push([[179],{30204:function(e,t,n){"use strict";var r=n(22928),a=(n(28594),n(35666),n(67294)),o=n(73935),l=n(4942),i=n(15861),s=(n(74916),n(64765),n(23123),n(66992),n(33948),n(41120)),c=n(41749),u=n(22318),d=n(79895),p=n(81395),f=n(21727),m=n(72063),g=(0,s.Z)((e=>({root:{padding:e.spacing(3,2)},leftIcon:{marginRight:e.spacing(1),float:"left"},rightIcon:{marginLeft:e.spacing(1)},message:{marginBottom:"0px!important"}})));function h(e){var{message:t,type:n}=e,a=g();return(0,r.Z)(d.Z,{className:a.root,role:"alert"},void 0,function(e){var t=g();switch(e){case"success":return(0,r.Z)(p.Z,{className:t.leftIcon,"aria-hidden":"true"});case"warning":return(0,r.Z)(f.Z,{className:t.leftIcon,"aria-hidden":"true"});case"danger":return(0,r.Z)(m.Z,{className:t.leftIcon,"aria-hidden":"true"});default:throw Error("Unknown type: "+e)}return null}(n),(0,r.Z)(u.Z,{variant:"body1",className:a.message,component:"p"},void 0,t))}var v=n(3283),y=n.n(v),w=n(73998),Z={1:null,3:null,4:null,56:null,97:null,137:null,80001:null,1851060726:new Date("2020-10-20T00:00:00"),1981:new Date("2022-04-05T00:00:00")},_=null;function b(){return x.apply(this,arguments)}function x(){return(x=(0,i.Z)((function*(){var{web3Endpoint:e,web3HTTPSEndpoint:t}=window.epg;if(_)return _;if(void 0===e)return _;var n=new(y())(new(y().providers.WebsocketProvider)(e)),r=yield n.eth.net.getId();if(console.log("getWEB3: netId=",r,Z),void 0===Z[r]||!(null===Z[r]||new Date<Z[r]))return console.log("getWEB3: no supported network found for",r),_;console.log("getWEB3: supported network found:",r);var a=[r],o=new w.zw({rpc:{[r]:t,1:t},bridge:"https://bridge.walletconnect.org",qrcode:!0,supportedChainIds:a,chainId:r});yield o.activate();var l=yield o.getProvider();l.on("accountsChanged",(e=>{console.log("WalletConnectConnector accountsChanged:",e)})),l.on("chainChanged",(e=>{console.log("WalletConnectConnector chainChanged:",e),_=null})),l.on("disconnect",((e,t)=>{console.log("WalletConnectConnector disconnect: ",e,t),_=null}));var i=new(y())(l);return _=i}))).apply(this,arguments)}var k=null;function H(){return C.apply(this,arguments)}function C(){return C=(0,i.Z)((function*(){if(k)try{var e=yield k.eth.net.getId();null!==e&&""!==e||(console.log("Empty network ID"),k=null)}catch(e){console.log(e),k=null}if(k)return k;if("undefined"!=typeof window&&void 0!==window.ethereum&&"function"==typeof window.ethereum.enable)return window.ethereum.enable().then(function(){var e=(0,i.Z)((function*(e){var t=window.ethereum,n=new(y())(t),r=yield n.eth.net.getId();return void 0!==Z[r]&&(null===Z[r]||new Date<Z[r])&&(k=n),k}));return function(t){return e.apply(this,arguments)}}()).catch((e=>(e&&console.log("User denied or ignored account access: ",e),null)));if("undefined"!=typeof window&&void 0!==window.web3){var t=window.web3.currentProvider,n=new(y())(t),r=yield n.eth.net.getId();return void 0!==Z[r]&&(null===Z[r]||new Date<Z[r])&&(k=n),k}return console.log("No dapp browser"),null})),C.apply(this,arguments)}var S=null;function V(){return T.apply(this,arguments)}function T(){return(T=(0,i.Z)((function*(){var{web3Endpoint:e}=window.epg;if(S)try{var t=yield S.eth.net.getId();null!==t&&""!==t||(console.log("Empty network ID"),S=null)}catch(e){console.log(e),S=null}if(!S){if(void 0!==e){var n=new(y())(new(y().providers.WebsocketProvider)(e)),r=yield n.eth.net.getId();return console.log("getWEB3: netId=",r,Z),void 0!==Z[r]&&(null===Z[r]||new Date<Z[r])&&(console.log("getWEB3: initialized"),S=n),S}throw Error("No web3 endpoint specified")}return S}))).apply(this,arguments)}function P(e,t){return N.apply(this,arguments)}function N(){return(N=(0,i.Z)((function*(e,t){return null!==e&&(null!==t&&(yield t.eth.net.getId())!==(yield e.eth.net.getId()))}))).apply(this,arguments)}function M(e,t){var[n,r]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{var t=function(){var t=(0,i.Z)((function*(){try{var t=yield V();if(null===t)return;var n=null;switch(e){case"metamask":case"trust":n=yield H();break;case"walletconnect":n=yield b();break;case"ethereum_wallet":case"qr":break;default:console.log("Unknown paymentMethod:",e)}if(null===n)return;r(yield P(t,n))}catch(e){console.log("Failed to check network mismatch: ",e)}}));return function(){return t.apply(this,arguments)}}();t()}),[e,t]),n}var O=n(8975),I=(0,s.Z)((e=>({root:{padding:e.spacing(3,2)},leftIcon:{marginRight:e.spacing(1),float:"left"},rightIcon:{marginLeft:e.spacing(1)},message:{marginBottom:"0px!important"}})));function B(e){var t=e;switch(e){case 1:t="Ethereum Mainnet";break;case 3:t="Ropsten Testnet";break;case 4:t="Rinkeby Testnet";break;case 56:t="Binance Smart Chain Mainnet";break;case 97:t="Binance Smart Chain Testnet";break;case 137:t="Polygon (MATIC) Mainnet";break;case 80001:t="Mumbai Testnet"}return t}function F(e){var{str_metamask_network_mismatch:t,str_metamask_network_mismatch_detailed:n}=window.epg,[o,l]=(0,a.useState)(t),{paymentMethod:s,tm:c}=e,p=I(),f=M(s,c);return(0,a.useEffect)((()=>{f&&(0,i.Z)((function*(){var e=yield V();if(null!==e){var t=null;switch(s){case"metamask":case"trust":t=yield H();break;case"walletconnect":t=yield b();break;case"ethereum_wallet":case"qr":break;default:console.log("Unknown paymentMethod:",s)}if(null!==t){var r=yield e.eth.net.getId(),a=yield t.eth.net.getId();l((0,O.sprintf)(n,B(a),B(r)))}}}))()}),[f]),f?(0,r.Z)(d.Z,{className:p.root,role:"alert"},void 0,(0,r.Z)(m.Z,{className:p.leftIcon,"aria-hidden":"true"}),(0,r.Z)(u.Z,{variant:"body1",className:p.message,component:"p"},void 0,o)):null}n(41817);var A=n(18463),E=n(89738),j=n(51907),D=n(79912),L=n(951),U=n(282),R=n(9248),W=n(77315),G=n(44080),z=(0,s.Z)((e=>({card:{width:"100%"},media:{height:140},button:{margin:e.spacing(1)},leftIcon:{marginRight:e.spacing(1)},rightIcon:{marginLeft:e.spacing(1)},iconSmall:{fontSize:20},description:{marginBottom:"0px!important",textTransform:"none!important",whiteSpace:"normal!important",wordBreak:"break-word!important"},accountAddress:{marginBottom:"0px!important",textTransform:"none!important"},title:{}})));function q(e){var{paymentMethodSelected:t,account:n,clearPaymentMethod:o,value:l}=e,i=t===l.mnemonic,s=z(),{baseURL:c,str_payment_method_card_connect_button_label:d,str_payment_method_card_disconnect_button_label:p}=window.epg;return(0,r.Z)(A.Z,{className:s.card},void 0,(0,r.Z)(E.Z,{onClick:i?o:l.action},void 0,(0,r.Z)(L.Z,{className:s.media,image:"".concat(c,"/img/").concat(l.image),title:l.title}),(0,r.Z)(D.Z,{},void 0,(0,r.Z)(u.Z,{className:s.title,gutterBottom:!0,variant:"h5",component:"h2"},void 0,l.title),function(e,t,n,o){return e?(0,r.Z)(a.Fragment,{},void 0,(0,r.Z)(u.Z,{variant:"h6",component:"h3"},void 0,window.epg.str_payment_method_card_account_label),(0,r.Z)(u.Z,{variant:"subtitle1",className:t.accountAddress,component:"p"},void 0,o)):(0,r.Z)(u.Z,{className:t.description,variant:"subtitle1",color:"textSecondary",component:"p"},void 0,n)}(i,s,l.description,n))),(0,r.Z)(j.Z,{},void 0,i?function(e,t,n){if(!e)return null;if(!t)return null;var a=z();return(0,r.Z)(U.Z,{variant:"contained",color:"primary",className:a.button,onClick:n},void 0,t,(0,r.Z)(G.Z,{className:a.rightIcon}))}(l.available,p,o):function(e,t,n){if(!e)return null;if(!t)return null;var a=z();return(0,r.Z)(U.Z,{variant:"contained",color:"primary",className:a.button,onClick:n},void 0,t,(0,r.Z)(W.Z,{className:a.rightIcon}))}(l.available,d,l.action),function(e){var t=e.downloadTitle,n=e.downloadURL;if(e.available)return null;if(!t)return null;var a=z();return(0,r.Z)(U.Z,{variant:"contained",color:"primary",className:a.button,href:n,target:"_blank"},void 0,t,(0,r.Z)(R.Z,{className:a.rightIcon}))}(l)))}var J,X,Y=n(87462),K=n(45987),Q=n(48623),$=n(66083),ee=n(80366),te=n(17812),ne=n(29525),re=n(7212),ae=n(66856),oe=n(39803),le=n(10637),ie=n(47298),se=n(62087),ce=n(81376),ue=["onClose","onChange","value"],de=(0,s.Z)((e=>({dialog:{},dialogTitle:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500],boxShadow:"none"},dialogContent:{padding:e.spacing(2)},dialogActions:{margin:0,padding:e.spacing(1)},paperScrollPaper:{},button:{},scanButton:{margin:e.spacing(1),marginRight:"0px",padding:e.spacing(1),minWidth:"inherit!important"},leftIcon:{marginRight:e.spacing(1)},rightIcon:{marginLeft:e.spacing(1)},iconSmall:{fontSize:20}})));function pe(e){var t=de(),{onClose:n,onChange:o,value:l}=e,s=(0,K.Z)(e,ue),[c,d]=(0,a.useState)(l),[p,f]=(0,a.useState)(!1),m=()=>{p?f(!1):o(c)},g=()=>{p?f(!1):n()},h=function(){var e=(0,i.Z)((function*(e){(yield V()).utils.isAddress(e)?(d(e),f(!1)):console.log("handleScan isAddress NOT OK:",e)}));return function(t){return e.apply(this,arguments)}}();return a.createElement(Q.Z,(0,Y.Z)({classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper},fullWidth:!0,maxWidth:"sm",onClose:g,"aria-labelledby":"account-dialog-title"},s),(0,r.Z)($.Z,{id:"account-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,(0,r.Z)(u.Z,{variant:"h6"},void 0,window.epg.str_account_dlg_title),(0,r.Z)(te.Z,{"aria-label":"close",className:t.closeButton,onClick:g},void 0,X||(X=(0,r.Z)(ee.Z,{})))),(0,r.Z)(ne.Z,{dividers:!0,classes:{root:t.dialogContent}},void 0,function(e,t,n,o,l,i,s,c,u){if(l)return(0,r.Z)(ce.Z,{delay:i,className:u.qrReader,onError:s,onScan:c});var{str_account_dlg_content:d,str_account_dlg_address_field_label:p,str_account_dlg_qrcode_button_label:f}=window.epg;return(0,r.Z)(a.Fragment,{},void 0,(0,r.Z)(re.Z,{},void 0,d),(0,r.Z)(oe.Z,{id:"account-address",label:p,value:e,className:u.textField,autoFocus:!0,margin:"dense",variant:"standard",fullWidth:!0,onChange:t,onKeyDown:e=>{13===e.keyCode&&n()},InputProps:{endAdornment:(0,r.Z)(U.Z,{onClick:()=>{o(!0)},size:"small",variant:"contained",color:"secondary","aria-label":f,title:f,classes:{root:u.scanButton}},void 0,J||(J=(0,r.Z)(se.Z,{},void 0,(0,r.Z)("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"}))))}}))}(c,(e=>{d(e.target.value)}),m,f,p,500,(e=>{console.log(e)}),h,t)),(0,r.Z)(ae.Z,{classes:{root:t.dialogActions}},void 0,function(e,t,n){var a,{str_account_dlg_ok_button_label:o,str_account_dlg_cancel_button_label:l}=window.epg;return t?(0,r.Z)(U.Z,{variant:"contained",color:"primary",className:n.button,onClick:e},void 0,(0,r.Z)(u.Z,{variant:"button"},void 0,l),(0,r.Z)(ie.Z,{className:n.rightIcon})):(0,r.Z)(U.Z,{variant:"contained",color:"primary",className:n.button,onClick:e},void 0,a||(a=(0,r.Z)(u.Z,{variant:"button"},void 0,o)),(0,r.Z)(le.Z,{className:n.rightIcon}))}(m,p,t)))}var fe=(0,s.Z)((e=>({root:{}})));function me(e){var{paymentMethod:t,account:n,clearPaymentMethod:o,payment_methods:l,accountDialogOpen:i,onAccountDialogClose:s,onAccountDialogChange:u}=e,d=fe();return(0,r.Z)(a.Fragment,{},void 0,(0,r.Z)(pe,{value:null!==n?n:"",open:i,onClose:s,onChange:u}),(0,r.Z)(c.Z,{container:!0,justify:"center",className:d.root,spacing:2},void 0,l.filter((e=>null===t||e.mnemonic===t)).map((e=>(0,r.Z)(c.Z,{xs:12,sm:6,item:!0},e.mnemonic,(0,r.Z)(q,{paymentMethodSelected:t,clearPaymentMethod:o,account:n,value:e}))))))}n(56977),n(54678);var ge,he=n(43700),ve=n(46479),ye=n(30585),we=n(64436),Ze=n(15785),_e=(n(2707),n(39714),n(91058),n(88674),n(36639)),be=(0,s.Z)((e=>({dialog:{minWidth:256},dialogTitle:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500],boxShadow:"none"},dialogContent:{padding:e.spacing(2)},dialogActions:{margin:0,padding:e.spacing(1)},paperScrollPaper:{},button:{}})));function xe(e){var t=be(),{title:n,message:a,actionText:o,onClose:l,open:i}=e,{str_alert_dlg_title_default:s,str_alert_dlg_ok_button_label:c}=window.epg;return(0,r.Z)(Q.Z,{"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",open:i,onClose:l,classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper}},void 0,(0,r.Z)($.Z,{id:"alert-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,(0,r.Z)(u.Z,{variant:"h6"},void 0,n||s),(0,r.Z)(te.Z,{"aria-label":"close",className:t.closeButton,onClick:l},void 0,ge||(ge=(0,r.Z)(ee.Z,{})))),(0,r.Z)(ne.Z,{},void 0,(0,r.Z)(re.Z,{id:"alert-dialog-description"},void 0,a)),(0,r.Z)(ae.Z,{},void 0,(0,r.Z)(U.Z,{onClick:l,variant:"contained",color:"primary",className:t.button,autoFocus:!0},void 0,o||c)))}var ke=n(44431),He="0x0000000000000000000000000000000000000001",Ce="0x0000000000000000000000000000000000000000";function Se(e){if(null===e)return null;var{base_currency_ticker:t,tokens_supported:n}=window.epg;if(He===e)return{symbol:t,address:He,rate:1};if(""===n)return null;for(var r=n.split(","),a=0;a<r.length;a++){var o=r[a].split(":");if(!(o.length<3)){var l=o[0],i=o[1],s=o[2];if(i.toLowerCase()===e.toLowerCase())return{symbol:l,address:i,rate:s}}}return null}function Ve(e){return parseFloat(e)*(100+parseFloat(window.epg.markup_percent_token))/(100+parseFloat(window.epg.markup_percent))}function Te(e,t){var[n,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==t){var n=t.address;r(He===n?e:0)}})),n}function Pe(e,t,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,i.Z)((function*(e,t,n){if(null===n)return!1;var r=yield n.eth.getCode(e),a=n.eth.abi.encodeFunctionSignature(t);return r.indexOf("63"+a.slice(2,a.length))>0}))).apply(this,arguments)}function Me(e,t){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,i.Z)((function*(e,t){if(null===t)return!1;try{return yield Pe(e,"send(address,uint256,bytes)",t)}catch(e){console.log(e)}return!1}))).apply(this,arguments)}var Ie={};function Be(e,t){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,i.Z)((function*(e,t){if(null===t)return!1;if(void 0!==Ie[e])return Ie[e];try{if(!Ie[e])return Ie[e]=Me(e,t),Ie[e]}catch(e){console.log(e)}return!1}))).apply(this,arguments)}function Ae(e,t,n){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,i.Z)((function*(e,t,n){if(null===n)return!1;var r=yield n.eth.getCode(e),a=n.eth.abi.encodeFunctionSignature(t);return r.indexOf("63"+a.slice(2,a.length))>0}))).apply(this,arguments)}var je={};function De(e,t){return Le.apply(this,arguments)}function Le(){return(Le=(0,i.Z)((function*(e,t){if(null===t)return!1;if(void 0!==je[e])return je[e];try{return je[e]=yield Ae(e,"transfer(address,uint256,bytes)",t),je[e]}catch(e){console.log(e)}return!1}))).apply(this,arguments)}function Ue(e,t,n){return Re.apply(this,arguments)}function Re(){return(Re=(0,i.Z)((function*(e,t,n){if(null===e)return null;var r=e.address,{gateway_address:a}=window.epg;if(He===r)return a;if(null===t)return null;if(null===n)return null;switch(t){case"deposit":return r;case"payment":return(yield Be(r,n))||(yield De(r,n))?r:a}throw console.log("Unknown paymentStep:",t),Error("Unknown paymentStep: "+t)}))).apply(this,arguments)}function We(e,t){var[n,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{var n=function(){var n=(0,i.Z)((function*(){var n=yield V();if(null!==n){var a=yield Ue(e,t,n);null!==a&&r(a)}}));return function(){return n.apply(this,arguments)}}();n()})),n}function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qe={};function Je(e,t){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,i.Z)((function*(e,t){if(null===e)return null;if(null===t)return null;var n=e.address;if(He===n)return 18;if(void 0!==qe[n])return qe[n];var r=JSON.parse(window.epg.erc20_abi);return new t.eth.Contract(r,n).methods.decimals().call().then((function(e){return null===e?(console.log("Failed to obtain ERC20 token decimals value"),null):(qe[n]=parseInt(e),qe[n])})).catch((function(e){console.log(e)}))}))).apply(this,arguments)}function Ye(e){var[t,n]=(0,a.useState)(null),[r,o]=(0,a.useState)({});return(0,a.useEffect)((()=>{var t=function(){var t=(0,i.Z)((function*(){if(null!==e){var t=yield V();if(null!==t){var a=e.address;if(void 0===r[a]){var l=yield Je(e,t);if(null===l)return;return o(ze(ze({},r),{},{[a]:l})),void n(l)}n(r[a])}}}));return function(){return t.apply(this,arguments)}}();t()})),t}var Ke=n(718);function Qe(e,t,n){var[r,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{var r=function(){var r=(0,i.Z)((function*(){var r=yield V();if(null!==r){var a=function(e,t,n,r){if(null===t)return null;if(null===n)return null;var a=t.address;if(He===a)return null;if(null===r)return null;var o=Se(a);if(null===o)return console.log("Unsupported token rate requested"),null;var l=Ve(e/parseFloat(o.rate));return Ke(l,15,"PHP_ROUND_HALF_UP")}(e,t,n,r);null!==a&&o(a)}}));return function(){return r.apply(this,arguments)}}();r()})),r}function $e(e,t,n,r){if(null===t)return null;if(null===n)return null;var a=t.address;if(He===a)return null;if(null===r)return null;var{token_value_payments_wei:o}=window.epg,l=JSON.parse(o);Se(a);return void 0===l[a]?(console.log("Unsupported token rate requested"),null):new ke.BigNumber(l[a])}var et=n(84956);function tt(e,t,n,r){return nt.apply(this,arguments)}function nt(){return(nt=(0,i.Z)((function*(e,t,n,r){if(null===e)return null;if(null===t)return null;var a=e.address;if(He===a)return null;if(null===r)return null;if((yield Be(a,r))||(yield De(a,r)))return null;var o=JSON.parse(window.epg.erc20_abi);return new r.eth.Contract(o,a).methods.allowance(t,n).call().then((function(e){return parseInt(e)})).catch((function(e){console.log(e)}))}))).apply(this,arguments)}function rt(e,t,n,r){var[o,l]=(0,a.useState)(null),s=e,c=window.epg.gateway_address,u=function(e,t,n){var r=(0,et.Z)(),[o,l]=(0,a.useState)(null);return(0,a.useEffect)((()=>{var a=function(){var a=(0,i.Z)((function*(){var a=yield V();if(null!==a){var o=yield tt(e,t,n,a);null!==o&&r()&&l(o)}}));return function(){return a.apply(this,arguments)}}();a()})),o}(n,s,c),d=Ye(n),p=function(e,t,n){var[r,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{var e=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var r=$e(0,t,n,e);null!==r&&o(r)}}));return function(){return e.apply(this,arguments)}}();e()})),r}(0,n,d),f=function(e,t,n,r,o){var[l,s]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==e){var a=e.address;if(He!==a&&null!==t&&null!==n&&null!==o){var l=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var t=JSON.parse(window.epg.erc20_abi),l=new e.eth.Contract(t,a),i=new ke.BigNumber(0);0===o&&(i=n);var c="0x"+e.utils.toBN("0x"+i.toString(16)).toString("hex");s(l.methods.approve(r,c).encodeABI())}}));return function(){return e.apply(this,arguments)}}();l()}}})),l}(n,d,p,c,u),m=function(){var[e,t]=(0,a.useState)(null);return(0,a.useEffect)((()=>{var e=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var{gateway_abi:n,gateway_address:r,payment_address:a,addressSite:o,order_id:l,masterVendor:i,masterVendorFee:s}=window.epg,c=JSON.parse(n),u=new e.eth.Contract(c,r);Ce!==i&&0!==parseFloat(s)?t(u.methods.payEthVA(a,o,l,i,s).encodeABI()):t(u.methods.payEthA(a,o,l).encodeABI())}}));return function(){return e.apply(this,arguments)}}();e()})),e}(),g=function(e,t,n){var[r,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==e){var r=e.address;if(He!==r&&null!==t&&null!==n){var a=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var{gateway_abi:t,gateway_address:a,payment_address:l,addressSite:i,order_id:s,masterVendor:c,masterVendorFee:u}=window.epg,d=JSON.parse(t),p=new e.eth.Contract(d,a),f=n,m="0x"+e.utils.toBN("0x"+f.toString(16)).toString("hex"),g=(yield Be(r,e))||(yield De(r,e));Ce!==c&&0!==parseFloat(u)?o(g?p.methods.payTokenVA_Fake(l,i,s,c,u).encodeABI():p.methods.payTokenVA(r,l,i,s,m,c,u).encodeABI()):o(g?p.methods.payTokenA_Fake(l,i,s).encodeABI():p.methods.payTokenA(r,l,i,s,m).encodeABI())}}));return function(){return e.apply(this,arguments)}}();a()}}})),r}(n,d,p),h=function(e){var[t,n]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==e){var t=e.address;if(He!==t){var r=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var r=yield Be(t,e);n(r)}}));return function(){return e.apply(this,arguments)}}();r()}else n(!1)}})),t}(n),v=function(e,t,n,r){var[o,l]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==e){var a=e.address;if(He!==a&&null!==t&&null!==n&&null!==r){var o=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var{gateway_address:t}=window.epg,o=JSON.parse(window.epg.erc777_abi),i=new e.eth.Contract(o,a),s=n,c="0x"+e.utils.toBN("0x"+s.toString(16)).toString("hex"),u=r.substring(0,10)+"00000000000000000000000000000000000000000000000000000000"+r.substring(10),d=i.methods.send(t,c,u).encodeABI();l(d)}}));return function(){return e.apply(this,arguments)}}();o()}}})),o}(n,d,p,g),y=function(e){var[t,n]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==e){var t=e.address;if(He!==t){var r=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var r=yield De(t,e);n(r)}}));return function(){return e.apply(this,arguments)}}();r()}else n(!1)}})),t}(n),w=function(e,t,n,r){var[o,l]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(null!==e){var a=e.address;if(He!==a&&null!==t&&null!==n&&null!==r){var o=function(){var e=(0,i.Z)((function*(){var e=yield V();if(null!==e){var{gateway_address:t}=window.epg,o=JSON.parse(window.epg.erc223_abi),i=new e.eth.Contract(o,a),s=n,c="0x"+e.utils.toBN("0x"+s.toString(16)).toString("hex"),u=r.substring(0,10)+"00000000000000000000000000000000000000000000000000000000"+r.substring(10),d=i.methods.transfer(t,c,u).encodeABI();l(d)}}));return function(){return e.apply(this,arguments)}}();o()}}})),o}(n,d,p,g);return(0,a.useEffect)((()=>{if(null!==n){var e=n.address;if(He!==e){if(null!==r)switch(r){case"deposit":l(f);break;case"payment":l(h?v:y?w:g);break;default:throw console.log("Unknown paymentStep:",r),Error("Unknown paymentStep: "+r)}}else l(m)}})),o}n(65069);function at(e,t){return ot.apply(this,arguments)}function ot(){return(ot=(0,i.Z)((function*(e,t){return lt(e,"latest",t)}))).apply(this,arguments)}function lt(e,t,n){return it.apply(this,arguments)}function it(){return(it=(0,i.Z)((function*(e,t,n){var r=yield n.getFeeHistory(300,t);console.log("feeHistory:",r);for(var a=[],o=[],l=0;l<r.baseFeePerGas.length;l++)a.push(parseInt(r.baseFeePerGas[l])),o.push(l);a[a.length-1]*=9/8;for(var i=r.gasUsedRatio.length-1;i>=0;i--)r.gasUsedRatio[i]>.9&&(a[i]=a[i+1]);o.sort((function(e,t){return a[e]-a[t]}));for(var s=yield ct(parseInt(r.oldestBlock),r.gasUsedRatio,n),c=[],u=0,d=e;d>=1;d/=2){var p=st(s,d),f=pt(a,o,d-1),m=0;f>u?u=f:(m=.25*(u-f),f=u),c.push({timeFactor:d,maxFeePerGas:Math.ceil(f+p),maxPriorityFeePerGas:Math.ceil(p+m)})}return c.reverse(),c}))).apply(this,arguments)}function st(e,t){return 0===e.length?2e9:e[Math.floor((e.length-1)*(40+30/t)/100)]}function ct(e,t,n){return ut.apply(this,arguments)}function ut(){return(ut=(0,i.Z)((function*(e,t,n){for(var r=[],a=0;a<=20;a++)r.push(a);for(var o=t.length-1,l=5,i=[];l>0&&o>=0;){var s=dt(t,o,l);if(s>0){console.log("suggestPriorityFee:",{blockCount:"0x"+s.toString(16),firstBlock:e,firstBlockPtr:e+o,percentiles:r});try{for(var c=yield n.getFeeHistory("0x"+s.toString(16),e+o,r),u=0;u<c.reward.length;u++)for(var d=0;d<=20;d++){var p=parseInt(c.reward[u][d]);p>0&&i.push(p)}if(c.reward.length<s)break}catch(e){console.log(e)}l-=s}o-=s+1}return i.sort((function(e,t){return e-t})),i}))).apply(this,arguments)}function dt(e,t,n){for(var r=0;n>0&&t>=0&&!(0===e[t]||e[t]>.9);)t--,n--,r++;return r}function pt(e,t,n){if(n<1e-6)return e[e.length-1];for(var r=(1-Math.exp(-1/n))/(1-Math.exp(-e.length/n)),a=0,o=0,l=0,i=0;i<t.length;i++){var s=ft(100*(a+=r*Math.exp((t[i]-e.length+1)/n)));if(o+=(s-l)*e[t[i]],s>=1)return o;l=s}return o}function ft(e){return e<=10?0:e>=30?1:(1-Math.cos(2*(e-10)*Math.PI/20))/2}function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(718);var ht=n(34424),vt=(0,s.Z)((e=>({root:{width:"100%"},button:{margin:e.spacing(1),marginLeft:e.spacing(-1),width:"100%"},leftIcon:{marginRight:e.spacing(1)},rightIcon:{marginLeft:e.spacing(1)},iconSmall:{fontSize:20}})));function yt(e,t,n,r,a,o,l,i){return wt.apply(this,arguments)}function wt(){return wt=(0,i.Z)((function*(e,t,n,r,a,o,l,s){try{var{gas_price:c,gas_limit:u,wp_rest_nonce:d,confirmations_number:p}=window.epg,f=yield a.eth.getBlock("latest"),m=void 0!==f.baseFeePerGas,g=m?yield at(128,a.eth):null;console.log("feeSuggestions:",g);var h=m?g.sort(((e,t)=>t.maxFeePerGas-e.maxFeePerGas))[0].maxFeePerGas:null,v=m?g.sort(((e,t)=>t.maxPriorityFeePerGas-e.maxPriorityFeePerGas))[0].maxPriorityFeePerGas:null,y=e,w={from:y,to:t,value:"0x"+a.utils.toBN(parseInt(n)).toString("hex"),data:r,gas:f.gasLimit},Z=yield a.eth.estimateGas(w);if(w=gt(gt({},w),{},{gas:"0x"+a.utils.toBN(Z).toString("hex")}),m)w=gt({maxFeePerGas:"0x"+a.utils.toBN(h).toString("hex"),maxPriorityFeePerGas:"0x"+a.utils.toBN(v).toString("hex")},w);else{var _=1e9*parseFloat(c),b=yield a.eth.getGasPrice(),x=1.5*parseInt(b.toString(10));x<_&&(x=_),w=gt({gasPrice:"0x"+a.utils.toBN("0x"+Math.floor(x).toString(16)).toString("hex")},w)}var k=yield a.eth.getTransactionCount(y),H=parseInt(k);w.nonce="0x"+H.toString(16);var C=yield o.eth.net.getId();w.chainId="0x"+C.toString(16),console.log(w);var S=p;o.eth.sendTransaction(w).once("transactionHash",function(){var e=(0,i.Z)((function*(e){console.log(e),(yield kt(e))&&(yield l(e))}));return function(t){return e.apply(this,arguments)}}()).on("confirmation",(function(e,t){(e>S||e===S)&&s.call(null,null,t.transactionHash)})).on("error",(function(e){s.call(null,e,null)})).then((function(e){})).catch((function(e){s.call(null,e,null)}))}catch(e){console.log(e),s.call(null,e,null)}})),wt.apply(this,arguments)}function Zt(e,t){return 0===e.length?e:(e.charAt(0)===t&&(e=e.substring(1)),0===e.length||e.charAt(e.length-1)===t&&(e=e.substring(0,e.length-1)),e)}var _t=e=>Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&");function bt(){return bt=(0,i.Z)((function*(e,t,n,r,a,o){try{var{user_wallet_address:l,gas_price:s,gas_limit:c,wp_rest_nonce:u,wp_rest_url:d,confirmations_number:p}=window.epg,f=yield r.eth.getBlock("latest"),m=void 0!==f.baseFeePerGas,g=m?yield at(128,r.eth):null;console.log("feeSuggestions:",g);var h=m?g.sort(((e,t)=>t.maxFeePerGas-e.maxFeePerGas))[0].maxFeePerGas:null,v=m?g.sort(((e,t)=>t.maxPriorityFeePerGas-e.maxPriorityFeePerGas))[0].maxPriorityFeePerGas:null,y=l,w={from:y,to:e,value:"0x"+r.utils.toBN(parseInt(t)).toString("hex"),data:n,gas:f.gasLimit},Z=yield r.eth.estimateGas(w);if(w=gt(gt({},w),{},{gas:"0x"+r.utils.toBN(Z).toString("hex")}),m)w=gt({maxFeePerGas:"0x"+r.utils.toBN(h).toString("hex"),maxPriorityFeePerGas:"0x"+r.utils.toBN(v).toString("hex")},w);else{var _=1e9*parseFloat(s),b=yield r.eth.getGasPrice(),x=1.5*parseInt(b.toString(10));x<_&&(x=_),w=gt({gasPrice:"0x"+r.utils.toBN("0x"+Math.floor(x).toString(16)).toString("hex")},w)}var k=yield r.eth.getTransactionCount(y),H=parseInt(k);w.nonce="0x"+H.toString(16),console.log(w);var C=u,S=yield fetch(d+"ethereumwallet/v1/web3_signTransaction",{method:"POST",headers:{Accept:"text/plain","Content-type":"application/x-www-form-urlencoded"},dataType:"text",body:_t(gt(gt({},w),{},{_wpnonce:C}))});if(null===S||'""'===S)return console.error("ethereum_wallet_signTransaction error: empty result"),void o.call(null,"empty result",null);var V=yield S.text();if('""'===V)return console.error("ethereum_wallet_signTransaction error: empty result"),void o.call(null,"empty result",null);var T=Zt(V,'"');console.log("txRawSigned:",T);var P=p;r.eth.sendSignedTransaction(T).once("transactionHash",function(){var e=(0,i.Z)((function*(e){console.log(e),(yield kt(e))&&(yield a(e))}));return function(t){return e.apply(this,arguments)}}()).on("confirmation",(function(e,t){(e>P||e===P)&&o.call(null,null,t.transactionHash)})).on("error",(function(e){o.call(null,e,null)})).then((function(e){})).catch((function(e){o.call(null,e,null)}))}catch(e){console.log(e),o.call(null,e,null)}})),bt.apply(this,arguments)}var xt={};function kt(e){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,i.Z)((function*(e){if(void 0!==xt[e])return!0;try{var{order_id:t,save_order_txhash_nonce:n,wpj_payment_type:r}=window.epg;yield fetch("/",{method:"POST",headers:{Accept:"text/plain","Content-type":"application/x-www-form-urlencoded"},dataType:"text",body:_t({txhash:e,order_id:t,save_order_txhash_nonce:n,action:"save_order_txhash",wpj_payment_type:r})});return window.history.replaceState&&window.history.replaceState(null,null,window.location.href),xt[e]=!0,!0}catch(e){return console.log(e),!1}}))).apply(this,arguments)}var Ct={};function St(){return Vt.apply(this,arguments)}function Vt(){return(Vt=(0,i.Z)((function*(){try{var{order_id:e,save_order_txhash_nonce:t,wpj_payment_type:n}=window.epg;if(void 0!==Ct[e+""+n])return!0;yield fetch("/",{method:"POST",headers:{Accept:"text/plain","Content-type":"application/x-www-form-urlencoded"},dataType:"text",body:_t({order_id:e,save_order_txhash_nonce:t,action:"update_confirmed_status",wpj_payment_type:n})});return window.history.replaceState&&window.history.replaceState(null,null,window.location.href),Ct[e+""+n]=!0,!0}catch(e){return console.log(e),!1}}))).apply(this,arguments)}function Tt(e){var t=vt(),[n,o]=(0,a.useState)(!1),[l,s]=(0,a.useState)(""),{paymentMethod:u,paymentMethods:d,paymentStep:p,account:f,etherAmount:m,currency:g,changeLastTxHash:h,amount:v,balance:y}=e,w=null===v?"":ht(ht(ht(v.toFixed(g.decimals||5),"0"),"."),","),Z=d.filter((e=>e.mnemonic===u))[0];if(!Z.hasWalletAccess)return null;var{str_payment_failed:_,str_pay_button_label:x,str_deposit_button_label:k,str_alert_dlg_title:C,eth_value_wei:S}=window.epg,T=0===Te(m,g)?0:S,N=We(g,p),M=rt(f,0,g,p),O=null!==p?p:"",I=function(){var e=(0,i.Z)((function*(e){switch(e.preventDefault(),u){case"metamask":case"trust":var t=yield V();if(null===t)break;var n=yield H();if(null===n)break;if(yield P(t,n))break;yield yt(f,N,T,M,t,n,h,((e,t)=>{if(e)return console.log(e),s(_),void o(!0)}));break;case"walletconnect":var r=yield V();if(null===r){console.log("handlePayment: null === web3");break}var a=yield b();if(null===a){console.log("handlePayment: null === web3metamask");break}if(yield P(r,a)){console.log("handlePayment: checkMMNetworkMismatch(web3, web3metamask)");break}yield yt(f,N,T,M,r,a,h,((e,t)=>{if(e)return console.log(e),s(_),void o(!0)}));break;case"ethereum_wallet":var l=yield V();if(null===l)break;yield function(e,t,n,r,a,o){return bt.apply(this,arguments)}(N,T,M,l,h,((e,t)=>{if(e)return console.log(e),s(_),void o(!0)}));break;case"qr":break;default:console.log("Unknown paymentMethod:",u)}}));return function(t){return e.apply(this,arguments)}}(),B=function(e,t){var{str_pay_button_label:n,str_deposit_button_label:r}=window.epg,[o,l]=(0,a.useState)(n);return(0,a.useEffect)((()=>{if(null!==e){var a=e.address;if(He!==a){if(null!==t&&He!==a)switch(t){case"deposit":l(r);break;case"payment":l(n);break;default:throw console.log("Unknown paymentStep:",t),Error("Unknown paymentStep: "+t)}}else l(n)}})),o}(g,p),F="0"===w||y<v;return(0,r.Z)(a.Fragment,{},void 0,(0,r.Z)(xe,{title:C,message:l,open:n,onClose:()=>{o(!1)}}),(0,r.Z)(c.Z,{className:t.root,container:!0,direction:"row-reverse"},void 0,(0,r.Z)(c.Z,{xs:12,sm:3,item:!0,className:O},void 0,(0,r.Z)(U.Z,{variant:"contained",disabled:F,color:"primary",className:t.button,onClick:I},void 0,B,(0,r.Z)(_e.Z,{className:t.rightIcon})))))}var Pt=n(89659),Nt=n(718);function Mt(e,t,n,r){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,i.Z)((function*(e,t,n,r){try{if(He===t){var a=yield r.eth.getBalance(e),o=parseInt(a)/1e18;if(o>=1e-4){o=Nt(o,5,"PHP_ROUND_HALF_DOWN")}return o}var l=JSON.parse(window.epg.erc20_abi),i=new r.eth.Contract(l,t),s=yield i.methods.balanceOf(e).call(),c=parseInt(s)/Math.pow(10,n);if(c>=1e-4){c=Nt(c,5,"PHP_ROUND_HALF_DOWN")}return c}catch(r){console.log("Failed to get balance for ",e,t,n,"; error =",r)}return null}))).apply(this,arguments)}var It={};function Bt(){return(Bt=(0,i.Z)((function*(e,t,n,r,a){var{web3Endpoint:o}=window.epg;if(null===e)return null;if(null===t)return null;if(null===n)return null;if(null===r)return null;if(void 0===o)return null;(void 0===It[e]&&(It[e]={}),void 0===It[e][t]&&(It[e][t]={}),void 0===It[e][t][o])?It[e][t][o]={tm:a,promise:Mt(e,t,n,r)}:It[e][t][o].tm<a&&(delete It[e][t][o],It[e][t][o]={tm:a,promise:Mt(e,t,n,r)});return It[e][t][o].promise}))).apply(this,arguments)}function Ft(e,t,n){var r=(0,et.Z)(),[o,l]=(0,a.useState)(null),s=Ye(t);return(0,a.useEffect)((()=>{if(null!==e&&null!==t&&null!==s){var a=function(){var a=(0,i.Z)((function*(){var a=yield V();if(null!==a){var o=t.address,i=yield function(e,t,n,r,a){return Bt.apply(this,arguments)}(e,o,s,a,n);r()&&l(i)}}));return function(){return a.apply(this,arguments)}}();a()}}),[e,t,s,n]),o}var At=n(34424),Et=(0,s.Z)((e=>({root:{padding:e.spacing(3,2)},content:{},row:{},item:{},control:{padding:e.spacing(2)},button:{margin:e.spacing(1)},formControl:{width:"100%"},selectEmpty:{marginTop:e.spacing(2)},helperText:{marginBottom:"0px!important"},amount:{marginBottom:"0px!important"},balance:{marginBottom:"0px!important"},product:{marginBottom:"0px!important"},link:{}})));function jt(e){var{currency:t,account:n,currencies:o,changePaymentCurrency:l,changeLastTxHash:i,paymentMethod:s,paymentMethods:p,paymentStep:f,tm:m}=e,{eth_value:g,str_payment_currency_selector_currency_label:h,str_payment_currency_selector_balance_value_default:v,str_payment_currency_selector_currency_helper_text:y,str_payment_currency_selector_amount_label:w}=window.epg,Z=function(e,t){var[n,r]=(0,a.useState)(null),o=Ye(t),l=Qe(e,t,o);return(0,a.useEffect)((()=>{if(null!==t){var n=t.address;r(He===n?e:l)}})),n}(parseFloat(g),t),_=Ft(n,t,m),b=M(s,m),x=Et();if(b)return null;var k=null===Z?"":At(At(At(Z.toFixed(t.decimals||5),"0"),"."),",");return(0,r.Z)(d.Z,{className:x.root},void 0,(0,r.Z)(c.Z,{container:!0,spacing:2,className:x.content},void 0,(0,r.Z)(c.Z,{item:!0,xs:12,className:x.row},void 0,(0,r.Z)(we.Z,{required:!0,className:x.formControl},void 0,(0,r.Z)(he.Z,{htmlFor:"currency"},void 0,h),(0,r.Z)(Ze.Z,{value:t?t.symbol:"",onChange:l,name:"currency",inputProps:{id:"currency"},className:x.selectEmpty},void 0,o.map((e=>(0,r.Z)(ve.Z,{value:e.symbol},e.symbol,e.symbol)))),(0,r.Z)(ye.Z,{className:x.helperText},void 0,y))),(0,r.Z)(c.Z,{container:!0,item:!0,xs:12,spacing:2,className:x.row},void 0,(0,r.Z)(c.Z,{item:!0,xs:12,sm:6,className:x.item},void 0,(0,r.Z)(u.Z,{variant:"h5",component:"h3"},void 0,w),(0,r.Z)(u.Z,{variant:"body1",className:x.amount,component:"p"},void 0,k," ",t.symbol)),(0,r.Z)(c.Z,{item:!0,xs:12,sm:6,className:x.item},void 0,function(e,t,n,o,l){var i,s,{token2wcproduct:c,str_payment_currency_selector_balance_label:d,str_payment_currency_selector_balance_value_default:p,str_purchase_tokens_button_text:f,str_purchase_ether_button_text:m}=window.epg;if(null===e)return(0,r.Z)(a.Fragment,{},void 0,i||(i=(0,r.Z)(u.Z,{variant:"h5",component:"h3"},void 0,d)),(0,r.Z)(u.Z,{variant:"body1",className:l.balance,component:"p"},void 0,p));var g=null===t?"":At(At(At(t.toFixed(o.decimals||5),"0"),"."),","),h=JSON.parse(c);if(void 0===h[o.address.toLowerCase()]||n<=t)return(0,r.Z)(a.Fragment,{},void 0,s||(s=(0,r.Z)(u.Z,{variant:"h5",component:"h3"},void 0,d)),(0,r.Z)(u.Z,{variant:"body1",className:l.balance,component:"p"},void 0,g," ",o.symbol));var v=m;return He!==o.address&&(v=(0,O.sprintf)(f,o.symbol)),(0,r.Z)(a.Fragment,{},void 0,(0,r.Z)(u.Z,{variant:"h5",component:"h3"},void 0,d),(0,r.Z)(u.Z,{variant:"body1",className:l.balance,component:"p"},void 0,g," ",o.symbol),(0,r.Z)(u.Z,{variant:"body2",className:l.product,component:"p"},void 0,(0,r.Z)(Pt.Z,{href:h[o.address.toLowerCase()],target:"_blank",className:l.link},void 0,v)))}(n,_,Z,t,x))),(0,r.Z)(c.Z,{item:!0,xs:12,className:x.row},void 0,(0,r.Z)(Tt,{paymentMethod:s,paymentMethods:p,paymentStep:f,account:n,etherAmount:g,currency:t,amount:Z,balance:_,changeLastTxHash:i}))))}var Dt,Lt=n(54794),Ut=n(74965),Rt=n(68479),Wt=n(64566),Gt=n(74855),zt=n(87239),qt=n(24837),Jt=(n(45697),n(14670)),Xt=n(79361),Yt=n.n(Xt),Kt=["classes","onClose","value"];var Qt,$t,en,tn,nn,rn,an,on=(0,Jt.Z)((e=>({grid:{overflowX:"inherit",overflowY:"inherit"},dialog:{overflowX:"inherit",overflowY:"inherit"},dialogTitle:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500],boxShadow:"none"},dialogContent:{padding:e.spacing(2),overflowX:"hidden",overflowY:"hidden"},paperScrollPaper:{height:"328px"}})))((function(e){var{classes:t,onClose:n,value:o}=e,l=(0,K.Z)(e,Kt);return""===o?null:a.createElement(Q.Z,(0,Y.Z)({classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper},fullWidth:!0,maxWidth:"xs",onClose:n,"aria-labelledby":"qrcode-dialog-title"},l),(0,r.Z)($.Z,{id:"qrcode-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,(0,r.Z)(u.Z,{variant:"h6"},void 0,window.epg.str_qrcode_dlg_title),(0,r.Z)(te.Z,{"aria-label":"close",className:t.closeButton,onClick:n},void 0,Dt||(Dt=(0,r.Z)(ee.Z,{})))),(0,r.Z)(ne.Z,{dividers:!0,classes:{root:t.dialogContent}},void 0,(0,r.Z)(c.Z,{container:!0,className:t.grid,alignItems:"center",direction:"row",justify:"center"},void 0,(0,r.Z)(Yt(),{value:o,title:o,size:235,includeMargin:!1}))))})),ln=(0,s.Z)((e=>({root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0,marginBottom:"0px!important"},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary,marginBottom:"0px!important"},textField:{width:"100%"},button:{margin:e.spacing(1),marginRight:"0px",padding:e.spacing(1),minWidth:"inherit!important"},buttonGroup:{width:"100%"}})));function sn(e,t){var{str_payment_step_unknown:n,str_payment_step_ether_payment:r,str_payment_step_token_deposit:a,str_payment_step_token_payment:o}=window.epg,l=n,i=e.address;if(He===i)l=r;else if(null!==t)switch(t){case"deposit":l=a;break;case"payment":l=o;break;default:throw console.log("Unknown paymentStep:",t),Error("Unknown paymentStep: "+t)}return l}function cn(e){var{account:t,etherAmount:n,currency:o,paymentMethod:l,paymentStep:i,expandedInitial:s,tm:d}=e,p=Te(n,o),f=We(o,i),m=rt(t,0,o,i),g=M(l,d),h=ln(),[v,y]=(0,a.useState)(s),[w,Z]=(0,a.useState)(!1),[_,b]=(0,a.useState)(""),[x,k]=(0,a.useState)(!1),[H,C]=(0,a.useState)("");if(g)return null;var{str_copied_to_clipboard:S,str_advanced_panel_title:V,str_advanced_panel_desc:T,str_payment_step_label:P,str_advanced_panel_address_label:N,str_copy_to_clipboard:O,str_advanced_panel_qrcode_button_label:I,str_advanced_panel_value_label:B,str_advanced_panel_data_label:F}=window.epg;return(0,r.Z)(a.Fragment,{},void 0,(0,r.Z)(xe,{title:S,message:H,open:x,onClose:()=>{k(!1)}}),(0,r.Z)(on,{value:_,open:w,onClose:()=>{Z(!1)}}),(0,r.Z)(Lt.Z,{className:h.root,expanded:v,onChange:(e,t)=>{y(t)}},void 0,(0,r.Z)(Rt.Z,{expandIcon:Qt||(Qt=(0,r.Z)(Wt.Z,{})),"aria-controls":"advancedbh-content",id:"advancedbh-header"},void 0,(0,r.Z)(u.Z,{variant:"h3",className:h.heading},void 0,V),(0,r.Z)(u.Z,{variant:"h4",className:h.secondaryHeading},void 0,T)),(0,r.Z)(Ut.Z,{},void 0,(0,r.Z)(c.Z,{container:!0,className:h.content},void 0,(0,r.Z)(c.Z,{item:!0,xs:12,className:h.row},void 0,(0,r.Z)(oe.Z,{id:"epg-payment-step-message",label:P,value:sn(o,i),className:h.textField,margin:"dense",InputProps:{readOnly:!0}})),(0,r.Z)(c.Z,{item:!0,xs:12,className:h.row},void 0,(0,r.Z)(oe.Z,{id:"epg-to-address",label:N,value:null!==f?f:"",className:h.textField,margin:"dense",variant:"standard",InputProps:{readOnly:!0,endAdornment:(0,r.Z)(qt.Z,{},void 0,(0,r.Z)(Gt.CopyToClipboard,{text:null!==f?f:"",onCopy:()=>{k(!0),C(null!==f?""+f:"")}},void 0,(0,r.Z)(U.Z,{size:"small",variant:"contained",color:"secondary","aria-label":O,title:O,classes:{root:h.button}},void 0,$t||($t=(0,r.Z)(zt.Z,{})))),(0,r.Z)(U.Z,{onClick:()=>{Z(!0),b(null!==f?""+f:"")},size:"small",variant:"contained",color:"secondary","aria-label":I,title:I,classes:{root:h.button}},void 0,en||(en=(0,r.Z)(se.Z,{},void 0,(0,r.Z)("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"})))))}})),(0,r.Z)(c.Z,{item:!0,xs:12,className:h.row},void 0,(0,r.Z)(oe.Z,{id:"epg-value",label:B,value:null!==p?p:"",className:h.textField,margin:"dense",variant:"standard",InputProps:{readOnly:!0,endAdornment:(0,r.Z)(qt.Z,{},void 0,(0,r.Z)(Gt.CopyToClipboard,{text:null!==p?p:"",onCopy:()=>{k(!0),C(null!==p?""+p:"")}},void 0,(0,r.Z)(U.Z,{size:"small",variant:"contained",color:"secondary","aria-label":O,title:O,classes:{root:h.button}},void 0,tn||(tn=(0,r.Z)(zt.Z,{})))),(0,r.Z)(U.Z,{onClick:()=>{Z(!0),b(null!==p?""+p:"")},size:"small",variant:"contained",color:"secondary","aria-label":I,title:I,classes:{root:h.button}},void 0,nn||(nn=(0,r.Z)(se.Z,{},void 0,(0,r.Z)("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"})))))}})),(0,r.Z)(c.Z,{item:!0,xs:12,className:h.row},void 0,(0,r.Z)(oe.Z,{id:"epg-data",label:F,value:null!==m?m:"",className:h.textField,multiline:!0,rowsMax:"4",margin:"dense",variant:"standard",InputProps:{readOnly:!0,endAdornment:(0,r.Z)(qt.Z,{},void 0,(0,r.Z)(Gt.CopyToClipboard,{text:null!==m?m:"",onCopy:()=>{k(!0),C(null!==m?""+m:"")}},void 0,(0,r.Z)(U.Z,{size:"small",variant:"contained",color:"secondary","aria-label":O,title:O,classes:{root:h.button}},void 0,rn||(rn=(0,r.Z)(zt.Z,{})))),(0,r.Z)(U.Z,{onClick:()=>{Z(!0),b(null!==m?""+m:"")},size:"small",variant:"contained",color:"secondary","aria-label":I,title:I,classes:{root:h.button}},void 0,an||(an=(0,r.Z)(se.Z,{},void 0,(0,r.Z)("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"})))))}}))))))}var un=n(43832),dn=n(95477),pn=["lastTxHash","lastTxConfirmations"],fn=(0,s.Z)((e=>({dialog:{overflowX:"hidden",overflowY:"hidden"},dialogTitle:{margin:0,padding:e.spacing(2)},dialogContent:{padding:e.spacing(2),overflowX:"hidden",overflowY:"hidden"},paperScrollPaper:{overflowX:"hidden",overflowY:"hidden"},grid:{overflowX:"hidden",overflowY:"hidden"},progress:{margin:e.spacing(2)},link:{}}))),mn=window.epg.confirmations_number||12;var gn=function(e){var t=fn(),{lastTxHash:n,lastTxConfirmations:o}=e,l=(0,K.Z)(e,pn),i=!1,s=0;null!==o&&(i=(s=o)<mn);var d=s+"/"+mn,{str_tx_progress_dlg_title:p,str_tx_progress_dlg_content:f}=window.epg,m=function(e){if(null===e)return null;var{blockchain_network:t,view_transaction_url:n}=window.epg;if(""!==n)return(0,O.sprintf)(n,e);var r="";return"mainnet"!==t&&(r=t+"."),"https://"+r+"etherscan.io/tx/"+e}(n);return a.createElement(Q.Z,(0,Y.Z)({classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper},open:i,maxWidth:"sm","aria-labelledby":"tx-progress-dialog-title"},l),(0,r.Z)($.Z,{id:"tx-progress-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,(0,r.Z)(u.Z,{variant:"h6"},void 0,p)),(0,r.Z)(ne.Z,{dividers:!0,classes:{root:t.dialogContent}},void 0,(0,r.Z)(c.Z,{container:!0,className:t.grid,alignItems:"center",direction:"row",justify:"center"},void 0,(0,r.Z)(dn.Z,{className:t.progress})),(0,r.Z)(un.Z,{maxWidth:"sm"},void 0,(0,r.Z)(u.Z,{variant:"body1",component:"p"},void 0,(0,O.sprintf)(f,d)),(0,r.Z)(u.Z,{variant:"body2",component:"p"},void 0,(0,r.Z)(Pt.Z,{href:m,target:"_blank",className:t.link},void 0,n)))))},hn=n(43337);function vn(e){var{blockchain_network:t}=window.epg,n="?module=account&action=txlist&address=%s&startblock=0&endblock=99999999&sort=desc",r=null;switch(t){case"mainnet":r=(0,O.sprintf)("https://api.etherscan.io/api"+n,e);break;case"ropsten":r=(0,O.sprintf)("https://api-ropsten.etherscan.io/api"+n,e);break;case"rinkeby":r=(0,O.sprintf)("https://api-rinkeby.etherscan.io/api"+n,e);break;case"bsc":r=(0,O.sprintf)("https://api.bscscan.com/api"+n,e);break;case"bsctest":r=(0,O.sprintf)("https://api-testnet.bscscan.com/api"+n,e)}return r}function yn(e){return wn.apply(this,arguments)}function wn(){return(wn=(0,i.Z)((function*(e){var{order_txhash:t,blockchain_network:n}=window.epg;if(null===e)return""!==t?t:null;if(!["mainnet","ropsten","rinkeby","bsc","bsctest"].includes(n))return null;var r=vn(e);if(null===r)return null;try{var a=yield fetch(r,{headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"}});if(!a.ok)return console.log(a.status),null;var o=yield a.json();if("1"!==o.status)return console.log(o.message),console.log(o.result),null;for(var l=0;l<o.result.length;l++){var i=o.result[l];if(e.toUpperCase()===i.from.toUpperCase())return i.hash}}catch(e){console.log(e)}return null}))).apply(this,arguments)}function Zn(e,t,n,r){return _n.apply(this,arguments)}function _n(){return(_n=(0,i.Z)((function*(e,t,n,r){if(null===e)return null;if(null===n)return null;if(null===r)return null;var a=n.address;if(He===a)return"payment";if((yield Be(a,r))||(yield De(a,r)))return"payment";var o=e,l=window.epg.gateway_address,i=yield tt(n,o,l,r),s=$e(0,n,yield Je(n,r),r);return 0===i||s.comparedTo(new ke.BigNumber(0))>0&&new ke.BigNumber(i).comparedTo(s)<0?"deposit":s.comparedTo(new ke.BigNumber(0))>0&&new ke.BigNumber(i).comparedTo(s)>=0?"payment":null}))).apply(this,arguments)}function bn(e){return xn.apply(this,arguments)}function xn(){return(xn=(0,i.Z)((function*(e){if(null===e)return null;var{gateway_abi:t,gateway_address:n,payment_address:r,addressSite:a,order_id:o}=window.epg,l=JSON.parse(t),i=new e.eth.Contract(l,n);try{var s=yield i.methods.getValuePayment(r,a,o).call();return null===s?s:parseInt(s)}catch(e){console.log(e,n,r,a,o)}}))).apply(this,arguments)}function kn(e){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,i.Z)((function*(e){if(null===e)return null;var{gateway_abi:t,gateway_address:n,payment_address:r,addressSite:a,order_id:o}=window.epg,l=JSON.parse(t),i=new e.eth.Contract(l,n);try{return yield i.methods.getCurrencyPayment(r,a,o).call()}catch(e){console.log(e,n,r,a,o)}return null}))).apply(this,arguments)}var Cn=n(718);function Sn(e,t){if(null===e)return!1;var{value:n}=window.epg,r="PHP_ROUND_HALF_UP";if(t!==He){if(Cn(e,15,r)<Cn(Ve(n),15,r))return!1}else if(Cn(e,15,r)<Cn(n,15,r))return!1;return!0}function Vn(e,t){return Tn.apply(this,arguments)}function Tn(){return(Tn=(0,i.Z)((function*(e,t){if(null===t)return null;var n=yield kn(t);return null===n?(console.log("getOrderPayed currencyPayment is null"),null):Sn(yield Pn(e,t),n)}))).apply(this,arguments)}function Pn(e,t){return Nn.apply(this,arguments)}function Nn(){return(Nn=(0,i.Z)((function*(e,t){if(null===t)return null;var n=yield bn(t);if(null===n)return null;var r=yield kn(t);if(null===r)return null;if(r===Ce||"0x"===r)return null;if(r===He)return n/1e18;var a=Se(r);if(null===a)return console.log("Failed to obtain token rate"),null;var o=yield Je(e,t);return null===o?null:a.rate*n/Math.pow(10,o)}))).apply(this,arguments)}var Mn=n(13457);function On(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function In(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?On(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):On(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bn=(0,n(32920).A)({}),Fn=(0,s.Z)((e=>({root:{flexGrow:1,padding:e.spacing(3,2)},content:{margin:"auto",maxWidth:750},row:{marginBottom:e.spacing(1)},title:{textAlign:"left"}})));function An(e,t){var n,r,a,o,l,i=(n=null,"undefined"!=typeof window&&void 0!==window.ethereum?n=window.ethereum:"undefined"!=typeof window&&void 0!==window.web3&&void 0!==window.web3.currentProvider&&(n=window.web3.currentProvider),n?n.isMetaMask?"metamask":n.isTrust?"trust":n.isGoWallet?"goWallet":n.isAlphaWallet?"alphaWallet":n.isStatus?"status":n.isToshi?"coinbase":void 0!==window.__CIPHER__?"cipher":"EthereumProvider"===n.constructor.name?"mist":"Web3FrameProvider"===n.constructor.name?"parity":n.host&&-1!==n.host.indexOf("infura")?"infura":n.host&&-1!==n.host.indexOf("localhost")?"localhost":"unknown":null),{str_download_metamask:s,str_download_metamask_mobile:c,str_download_trust:u,str_trust_wallet_title:d,str_trust_wallet_desc:p,str_metamask_title:f,str_metamask_desc:m,str_ethereum_wallet_title:g,str_ethereum_wallet_desc:h,str_walletconnect_title:v,str_walletconnect_desc:y}=window.epg,w=[],Z=(a=!1,r=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4)))&&(a=!0),a),_=Z?c:s,x=Z?(o=window.location,l=o.host+o.pathname+o.search+o.hash,"https://metamask.app.link/dapp/"+encodeURIComponent(l)):"https://metamask.io/";return w.push({mnemonic:"metamask",image:"metamask.svg",title:f,description:m,downloadTitle:"metamask"!==i?_:null,downloadURL:"metamask"!==i?x:null,hasWalletAccess:!0,available:"metamask"===i,action:()=>{H().then((t=>{t.eth.getAccounts(((t,n)=>{t?console.log(t):e("metamask",n)}))}))}}),w.push({mnemonic:"walletconnect",image:"walletconnect.svg",title:v,description:y,downloadTitle:null,downloadURL:null,hasWalletAccess:!0,available:!0,action:()=>{b().then((t=>{t.eth.getAccounts(((t,n)=>{t?console.log(t):e("walletconnect",n)}))}))}}),void 0!==window.epg.user_wallet_address&&""!==window.epg.user_wallet_address&&w.push({mnemonic:"ethereum_wallet",image:"ethereum-wallet.svg",title:g,description:h,downloadTitle:null,downloadURL:null,hasWalletAccess:!0,available:!0,action:()=>{e("ethereum_wallet",[window.epg.user_wallet_address])}}),w}function En(e,t){if(""===t)return null;var n=e.filter((e=>e.symbol===t));if(0===n.length)throw Error("Unknown currency symbol");return n[0]}var jn,Dn={};function Ln(e,t){return Un.apply(this,arguments)}function Un(){return(Un=(0,i.Z)((function*(e,t){if(null===e)return null;if(void 0!==Dn[e])return Dn[e];var n=yield t.eth.getTransactionReceipt(e);return null===n?null:(Dn[e]=n,n)}))).apply(this,arguments)}function Rn(e,t){return Wn.apply(this,arguments)}function Wn(){return(Wn=(0,i.Z)((function*(e,t){if(null===e)return null;var n=yield Ln(e,t);if(null===n)return 0;var r=(yield t.eth.getBlockNumber())-n.blockNumber+1;return r>=0?r:0}))).apply(this,arguments)}function Gn(e,t,n,r){return zn.apply(this,arguments)}function zn(){return(zn=(0,i.Z)((function*(e,t,n,r){var a=r.length>0?r[0]:null,o={paymentMethod:n,account:a},l=yield qn(In(In({},e),o),a);if(o=In(In({},o),l),t.length>0){var i=t[0].symbol,s=yield Xn(In(In({},e),o),t,i);o=In(In({},o),s)}return console.log("getPaymentMethodChangeResults:",n,r,e,o),o}))).apply(this,arguments)}function qn(e,t){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,i.Z)((function*(e,t){if(null===t)return{account:t,lastTxHash:null,lastTxConfirmations:null};var n=yield yn(t),r=yield V();return{account:t,lastTxHash:n,lastTxConfirmations:null!==n?yield Rn(n,r):null}}))).apply(this,arguments)}function Xn(e,t,n){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,i.Z)((function*(e,t,n){var r=En(t,n),a=yield V(),o=window.epg.eth_value;return{currency:r,paymentStep:yield Zn(e.account,o,r,a)}}))).apply(this,arguments)}function Kn(){return(Kn=(0,i.Z)((function*(e,t,n,r){var a=yield V(),o=void 0===r?yield Rn(t,a):r;console.log("getLastTxHashChangeResults: lastTxConfirmations:",o);var l=yield Qn(In(In({},e),{},{lastTxHash:t}),o,n);return In({lastTxConfirmations:o},l)}))).apply(this,arguments)}function Qn(e,t,n){return $n.apply(this,arguments)}function $n(){return($n=(0,i.Z)((function*(e,t,n){var r=yield V(),a=window.epg.eth_value,o=yield Zn(e.account,a,e.currency,r),l=null!==t&&t>=mn;l&&(l=yield Vn(e.currency,r));var i=yield er(In(In({},e),{},{lastTxConfirmations:t}),l,n);return In({paymentStep:o,isOrderPayed:l},i)}))).apply(this,arguments)}function er(e,t,n){return tr.apply(this,arguments)}function tr(){return(tr=(0,i.Z)((function*(e,t,n){var{str_payment_complete:r,str_payment_success_label:a,wpj_payment_type:o,order_id:l,payment_id:i}=window.epg;if(t){var s=r;null!==e.lastTxHash&&(s=(0,O.sprintf)(a,e.lastTxHash));var c={message:s,type:"success"};if(window.scrollTo(0,n.current.offsetTop),void 0===o)setTimeout((()=>{location.reload()}),1e4);else{yield St();var u="/?jb_action=loader_page&oid="+l+"&wpj_payment_id="+i;setTimeout((()=>{location.href=u}),1e4)}return{infoMessage:c}}return{}}))).apply(this,arguments)}function nr(e){var t=Fn(),n=(0,a.useRef)(null),o=function(){var{decimals_ether:e,disable_ether:t,tokens_supported:n,base_currency_ticker:r}=window.epg,a=[];"no"===t&&a.push({symbol:r,address:He,rate:1,decimals:e});var o=n.split(",").map((e=>{var t=e.split(":");return t.length<5?{symbol:t[0],address:t[1],rate:t[2]}:{symbol:t[0],address:t[1],rate:t[2],decimals:t[5]}}));return a.concat(o)}(),[l,s]=(0,a.useState)(Math.floor((new Date).getTime()/1e4)),[d,p]=(0,a.useState)({infoMessage:{message:null,type:"warning"},lastTxHash:null,lastTxConfirmations:null,paymentStep:null,isOrderPayed:!1,account:null,paymentMethod:null,accountDialogOpen:!1,currency:null}),f=function(){var e=(0,i.Z)((function*(e){console.log("changeLastTxHash:",e);var t=yield function(e,t,n,r){return Kn.apply(this,arguments)}(d,e,n);yield kt(e);p(In(In(In({},d),t),{},{lastTxHash:e}))}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,i.Z)((function*(){var e=yield V(),t=yield Ue(d.currency,d.paymentStep,e);if(null!==t){var r=null;switch(d.paymentStep){case"deposit":var{gateway_address:a,erc20_abi:o}=window.epg,l=JSON.parse(o),s=d.currency.address,c=new e.eth.Contract(l,s);r=c.events.Approval({filter:{_owner:d.account,_spender:a}});break;case"payment":var{gateway_address:u,gateway_abi:m,payment_address:g,order_id:h}=window.epg,v=JSON.parse(m),y=(d.currency.address,new e.eth.Contract(v,u));r=y.events.PaymentOccured({filter:{_sellerAddress:g,_orderId:h}})}if(null!==r)return console.log("Subscribing to",t),r.on("data",(r=>{if(console.log("data:",r),r.address.toLowerCase()===t.toLowerCase()){var{gateway_address:a,payment_address:o,order_id:l}=window.epg;if("Approval"!==r.event||r.returnValues[0].toLowerCase()===d.account.toLowerCase()&&r.returnValues[1].toLowerCase()===a.toLowerCase())if("PaymentOccured"!==r.event||r.returnValues[1].toLowerCase()===o.toLowerCase()&&e.utils.toBN(r.returnValues[3]).eq(e.utils.toBN(l))){var{transactionHash:s}=r,c=function(){var e=(0,i.Z)((function*(){var e=s,t=yield V(),r={};if(r.lastTxHash=e,null===d.lastTxHash||r.lastTxHash===d.lastTxHash){if(null===d.lastTxConfirmations||d.lastTxConfirmations<mn){var a=yield Rn(r.lastTxHash,t);console.log("useInterval: lastTxConfirmations2:",a),null!==a&&(r.lastTxConfirmations=a)}}else{var o=yield Rn(r.lastTxHash,t);console.log("useInterval: lastTxConfirmations2:",o),null!==o?null!==d.lastTxConfirmations&&o>10&&d.lastTxConfirmations<o?(console.log("old tx hash arrived"),r.lastTxHash=d.lastTxHash):r.lastTxConfirmations=o:r.lastTxConfirmations=0}if(r.lastTxHash!==d.lastTxHash)yield f(r.lastTxHash);else if(void 0!==r.lastTxConfirmations&&r.lastTxConfirmations!==d.lastTxConfirmations){var l=yield Qn(d,r.lastTxConfirmations,n);p(In(In(In({},d),l),{},{lastTxConfirmations:r.lastTxConfirmations}))}}));return function(){return e.apply(this,arguments)}}();c()}else console.log("skip PaymentOccured data:",o,l);else console.log("skip Approval data:",d.account,a)}else console.log("skip data for address:",r.address)})).on("changed",(e=>{console.log("changed:",e)})).on("error",(e=>{console.log("error:",e)})),()=>{console.log("Unsubscribing from",t),r.unsubscribe(((e,t)=>{if(e)return console.log(e),void console.log("Failed to unsubscribe!");t?console.log("Successfully unsubscribed!"):console.log("Failed to unsubscribe!")}))};console.log("No event subscription found")}}));return function(){return e.apply(this,arguments)}}();(0,hn.Z)((()=>{s(Math.floor((new Date).getTime()/1e4))}),1e3),(0,a.useEffect)((()=>{m()}),[d.account,d.currency,d.paymentStep]);var g=An(((e,t)=>{var n=function(){var n=(0,i.Z)((function*(){var n=yield Gn(d,o,e,t);p(In(In({},d),n))}));return function(){return n.apply(this,arguments)}}();n()})),v=function(){var e=(0,i.Z)((function*(){var e=null!==d.lastTxHash?d.lastTxHash:yield yn(d.account);if(null!==e){var t=yield V(),r={};if(r.lastTxHash=e,null===d.lastTxConfirmations||d.lastTxConfirmations<mn){var a=yield Rn(r.lastTxHash,t);console.log("useInterval: lastTxConfirmations2:",a),null!==a&&(r.lastTxConfirmations=a)}if(void 0!==r.lastTxConfirmations&&r.lastTxConfirmations!==d.lastTxConfirmations){var o=yield Qn(d,r.lastTxConfirmations,n);p(In(In(In({},d),o),{},{lastTxConfirmations:r.lastTxConfirmations}))}}}));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((()=>{v()}),[l]);var{infoMessage:y,account:w,paymentMethod:Z,currency:_,lastTxHash:x,lastTxConfirmations:k,paymentStep:H,isOrderPayed:C}=d;return(0,r.Z)(Mn.Z,{theme:Bn},void 0,a.createElement("section",{ref:n,className:"epg-payment-instructions"},(0,r.Z)(gn,{lastTxHash:x,lastTxConfirmations:k}),(0,r.Z)("div",{className:t.root},void 0,(0,r.Z)(c.Z,{container:!0,justify:"center",className:t.content},void 0,(0,r.Z)(c.Z,{item:!0,xs:12,className:t.row},void 0,(0,r.Z)(u.Z,{className:t.title,variant:"h2"},void 0,window.epg.str_gateway_title_text)),(0,r.Z)(c.Z,{item:!0,xs:12,className:t.row},void 0,function(e){return e.message?(0,r.Z)(h,{message:e.message,type:e.type}):null}(y)),(0,r.Z)(c.Z,{item:!0,xs:12,className:t.row},void 0,!C&&function(e,t){return null===e?null:(0,r.Z)(F,{paymentMethod:e,tm:t})}(Z,l)),(0,r.Z)(c.Z,{item:!0,xs:12,className:t.row},void 0,!C&&function(e,t,n,a,o,l,i){return(0,r.Z)(me,{payment_methods:a,paymentMethod:e,account:t,accountDialogOpen:o,onAccountDialogClose:l,onAccountDialogChange:i,clearPaymentMethod:n})}(Z,w,(()=>{console.log("clearPaymentMethodHandler",d);var e=[],t=function(){var t=(0,i.Z)((function*(){var t=d.paymentMethod,n=yield Gn(d,o,null,e);p(In(In({},d),n));var r=null;switch(t){case"metamask":case"trust":case"ethereum_wallet":case"qr":break;case"walletconnect":var a=yield b();null!==a&&(r=a.currentProvider);break;default:console.log("Unknown paymentMethod:",t)}null!==r&&(yield r.disconnect())}));return function(){return t.apply(this,arguments)}}();t()}),g,d.accountDialogOpen,(e=>{p(In(In({},d),{},{accountDialogOpen:!1}))}),(e=>{console.log("handleAccountDialogChange:",e);var t=function(){var t=(0,i.Z)((function*(){var t=[];(yield V()).utils.isAddress(e)||(e=null,console.log("handleAccountDialogChange: isAddress NOT OK"));var n=null;null!==e&&(n="qr",t.push(e));var r=yield Gn(d,o,n,t);p(In(In(In({},d),r),{},{accountDialogOpen:!1}))}));return function(){return t.apply(this,arguments)}}();t()}))),(0,r.Z)(c.Z,{item:!0,xs:12,className:t.row},void 0,!C&&function(e,t,n,a,o,l,i,s,c){return null===n?null:(0,r.Z)(jt,{currency:e,account:t,paymentMethod:n,paymentMethods:a,currencies:i,changePaymentCurrency:s,paymentStep:o,changeLastTxHash:l,tm:c})}(_,w,Z,g,H,f,o,(e=>{var t=e.target.value;if(console.log("changePaymentCurrencyHandler:",t,d),En(o,t)!==d.currency){var n=function(){var e=(0,i.Z)((function*(){var e=yield Xn(d,o,t);p(In(In({},d),e))}));return function(){return e.apply(this,arguments)}}();n()}}),l)),(0,r.Z)(c.Z,{item:!0,xs:12},void 0,!C&&function(e,t,n,a,o,l){if(null===n)return null;if(null===o)return null;if(null===t)return null;var i=!a.filter((e=>e.mnemonic===n))[0].hasWalletAccess,{eth_value:s}=window.epg;return(0,r.Z)(cn,{account:e,paymentStep:o,paymentMethod:n,expandedInitial:i,etherAmount:s,currency:t,tm:l})}(w,_,Z,g,H,l))))))}var rr=document.getElementById("ether-and-erc20-tokens-woocommerce-payment-gateway-widget");rr?o.render((0,r.Z)(nr,{}),rr):document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("ether-and-erc20-tokens-woocommerce-payment-gateway-widget");e&&o.render(jn||(jn=(0,r.Z)(nr,{})),e)}))},62859:function(){},75304:function(){},46601:function(){},71922:function(){},2363:function(){},52361:function(){},94616:function(){},6567:function(){},56773:function(){},33557:function(){}},function(e){e.O(0,[216],(function(){return t=30204,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=main.7a9496a4a49dcac85cc3.js.map